"use strict";(self.webpackChunkark_website=self.webpackChunkark_website||[]).push([[477],{10:e=>{e.exports=JSON.parse('{"blogPosts":[{"id":"liquidity-requirements","metadata":{"permalink":"/blog/liquidity-requirements","editUrl":"https://github.com/ark-network/ark/edit/master/website/blog/blog/2023-12-14-liquidity-requirements/index.md","source":"@site/blog/2023-12-14-liquidity-requirements/index.md","title":"Understanding Ark Liquidity Requirements","description":"Dive into the depths of Ark with our comprehensive guide on Liquidity Requirements. Explore how Ark liquidity intersect with money velocity","date":"2023-12-14T00:00:00.000Z","formattedDate":"December 14, 2023","tags":[{"label":"liquidity","permalink":"/blog/tags/liquidity"},{"label":"ark","permalink":"/blog/tags/ark"},{"label":"bitcoin","permalink":"/blog/tags/bitcoin"}],"readingTime":16.3,"hasTruncateMarker":true,"authors":[{"name":"Jo\xe3o Bordalo","title":"Developer","url":"https://github.com/bordalix","imageURL":"https://github.com/bordalix.png","key":"bordalix"}],"frontMatter":{"authors":"bordalix","description":"Dive into the depths of Ark with our comprehensive guide on Liquidity Requirements. Explore how Ark liquidity intersect with money velocity","image":"/img/ark-agora.png","slug":"liquidity-requirements","tags":["liquidity","ark","bitcoin"],"title":"Understanding Ark Liquidity Requirements","unlisted":true}},"content":"![Bitcoin agora](/img/ark-agora.png)\\n\\nThis post discusses the liquidity requirements and calculates the funding needs of Ark Service Provider (ASP), as all transactions within Ark must be funded by the ASP.\\n\\n\x3c!-- truncate --\x3e\\n\\n## What is Ark?\\n\\nArk is a promising second-layer solution for Bitcoin that could help improve the scalability and privacy of the network. It offers the following benefits:\\n\\n- **No incoming liquidity required**: Receivers can accept payments without having to worry about having enough funds in their wallets.\\n- **Confidential payments**: Ark protects the confidentiality of recipients, which is not always possible with other second-layer solutions.\\n- **Scalable**: Ark is a scalable solution that can help improve the scalability of Bitcoin.\\n- **Secure**: Ark is a secure solution that is built on top of the Bitcoin blockchain.\\n\\n:::tip\\nIt\'s recommended to read the [nomenclature](/learn/nomenclature) first.\\n:::\\n\\n## Ark liquidity requirements\\n\\nHow much BTC can an ASP accept from new users without risking not having enough capital to fund transfers inside Ark? In other words, what percentage of BTC in Ark is transferred in a 1-month period?\\n\\nThis is similar to the definition of money velocity, as defined by the St. Louis Fed:\\n\\n> The velocity of money is the frequency at which one unit of currency is used to purchase domestically-produced goods and services within a given time period.\\n\\n### Money velocity (MV)\\n\\nHere are some money velocity numbers:\\n\\n- USD (Q3 2023): 1.327\\n- Lightning (August 2023): 0.59 per month\\n\\nIf we use a money velocity of 1.00 (for simplicity), this means that each BTC inside the Ark will be spent 1.00 of the time on a given period. Since the ASP must fund all transactions and onboarding, this means that for each 1 BTC added to the Ark, the ASP will need 1 BTC to fund the onboarding and 1 BTC to fund the transfers inside the Ark. With an initial balance of 100 BTC, this results in a limit of 50 BTC allowed to onboard (100 = 50 for onboarding + 50 for trades).\\n\\nIf MV = 0.59, this means that those initial 100 BTC would allow for 62.89 BTC of onboarding, where (100 = 62.89 for onboarding + (69.89 \\\\* 0.59 = 37.11) for trades).\\n\\nIn reality, the money velocity of Ark is likely to be somewhere between 1.00 and 0.59. This means that the ASP will need to have a certain amount of liquidity on hand to fund both onboarded BTC and transfers inside the Ark. The amount of liquidity required will depend on the specific money velocity of Ark, which is not yet known for sure.\\n\\nComparison table:\\n\\n| Money velocity | Balance | +Onboard (BTC) | Inside Ark (BTC) | Transfers (BTC) |\\n| -------------: | ------: | -------------: | ---------------: | --------------: |\\n|           0.59 |  100.00 |          62.89 |             0.00 |           37.11 |\\n|           1.00 |  100.00 |          50.00 |             0.00 |           50.00 |\\n|          1.327 |  100.00 |          42.97 |             0.00 |           57.03 |\\n\\nAfter one month, all the funds used by the ASP, plus the funds sent by the users, become available again. This means that the ASP will have more available liquidity, so it can increase the allowed value for onboards. On the other hand, there is now more capital inside the Ark, so the ASP needs to reserve more capital to fund the transfers:\\n\\n| Money velocity | Balance | +Onboard (BTC) | Inside Ark (BTC) | Transfers (BTC) |\\n| -------------: | ------: | -------------: | ---------------: | --------------: |\\n|           0.59 |  162.89 |          79.11 |            62.89 |           83.78 |\\n|           1.00 |     150 |          50.00 |            50.00 |          100.00 |\\n|          1.327 |  142.97 |          36.93 |            42.97 |           57.03 |\\n\\nNow, what would happen in a one-year period?\\n\\n:::info\\nYou can run your own simulations with the <a href=\\"/liquidity-simulator/\\" target=\\"_blank\\">Ark liquidity simulator</a>.\\n:::\\n\\n### Simulating for 1 year\\n\\nColumns definition:\\n\\n- Inside Ark = Accumulated of allowed onboards\\n- ASP Balance = Initial balance + Inside Ark\\n- Reserved for trades = Inside Ark \\\\* MV\\n- Remaining = Balance - Reserved for trades\\n- Allowed onboards = Remaining / (1 + MV)\\n\\nMoney Velocity: 0.59\\n\\n| Month | Inside Ark | ASP Balance | Reserved for trades | Remaining | Allowed onboards |\\n| ----: | :--------: | :---------: | :-----------------: | :-------: | :--------------: |\\n|     0 |    0.00    |   100.00    |        0.00         |  100.00   |       0.00       |\\n|     1 |    0.00    |   100.00    |        0.00         |  100.00   |      62.89       |\\n|     2 |   62.89    |   162.89    |        37.11        |  125.79   |      79.11       |\\n|     3 |   142.00   |   242.00    |        83.78        |  158.22   |      99.51       |\\n|     4 |   241.51   |   341.51    |       142.49        |  199.02   |      125.17      |\\n|     5 |   366.68   |   466.68    |       216.34        |  250.34   |      157.45      |\\n|     6 |   524.13   |   624.13    |       309.24        |  314.89   |      198.05      |\\n|     7 |   722.18   |   822.18    |       426.09        |  396.09   |      249.12      |\\n|     8 |   971.29   |  1,071.29   |       573.06        |  498.23   |      313.35      |\\n|     9 |  1,284.65  |  1,384.65   |       757.94        |  626.70   |      394.15      |\\n|    10 |  1,678.80  |  1,778.80   |       990.49        |  788.31   |      495.79      |\\n|    11 |  2,174.59  |  2,274.59   |      1,283.01       |  991.58   |      623.64      |\\n|    12 |  2,798.23  |  2,898.23   |      1,650.95       | 1,247.27  |      784.45      |\\n\\nMoney Velocity: 1\\n\\n| Month | Inside Ark | ASP Balance | Reserved for trades | Remaining | Allowed onboards |\\n| ----: | :--------: | :---------: | :-----------------: | :-------: | :--------------: |\\n|     0 |    0.00    |   100.00    |        0.00         |  100.00   |       0.00       |\\n|     1 |    0.00    |   100.00    |        0.00         |  100.00   |      50.00       |\\n|     2 |   50.00    |   150.00    |        50.00        |  100.00   |      50.00       |\\n|     3 |   100.00   |   200.00    |       100.00        |  100.00   |      50.00       |\\n|     4 |   150.00   |   250.00    |       150.00        |  100.00   |      50.00       |\\n|     5 |   200.00   |   300.00    |       200.00        |  100.00   |      50.00       |\\n|     6 |   250.00   |   350.00    |       250.00        |  100.00   |      50.00       |\\n|     7 |   300.00   |   400.00    |       300.00        |  100.00   |      50.00       |\\n|     8 |   350.00   |   450.00    |       350.00        |  100.00   |      50.00       |\\n|     9 |   400.00   |   500.00    |       400.00        |  100.00   |      50.00       |\\n|    10 |   450.00   |   550.00    |       450.00        |  100.00   |      50.00       |\\n|    11 |   500.00   |   600.00    |       500.00        |  100.00   |      50.00       |\\n|    12 |   550.00   |   650.00    |       550.00        |  100.00   |      50.00       |\\n\\nMoney Velocity 1.327\\n\\n| Month | Inside Ark | ASP Balance | Reserved for trades | Remaining | Allowed onboards |\\n| ----: | :--------: | :---------: | :-----------------: | :-------: | :--------------: |\\n|     0 |    0.00    |   100.00    |        0.00         |  100.00   |       0.00       |\\n|     1 |    0.00    |   100.00    |        0.00         |  100.00   |      42.97       |\\n|     2 |   42.97    |   142.97    |        57.03        |   85.95   |      36.93       |\\n|     3 |   79.91    |   179.91    |       106.04        |   73.87   |      31.74       |\\n|     4 |   111.65   |   211.65    |       148.16        |   63.49   |      27.28       |\\n|     5 |   138.94   |   238.94    |       184.37        |   54.57   |      23.45       |\\n|     6 |   162.39   |   262.39    |       215.49        |   46.90   |      20.15       |\\n|     7 |   182.54   |   282.54    |       242.23        |   40.31   |      17.32       |\\n|     8 |   199.86   |   299.86    |       265.22        |   34.64   |      14.89       |\\n|     9 |   214.75   |   314.75    |       284.98        |   29.78   |      12.80       |\\n|    10 |   227.55   |   327.55    |       301.96        |   25.59   |      11.00       |\\n|    11 |   238.55   |   338.55    |       316.55        |   22.00   |       9.45       |\\n|    12 |   248.00   |   348.00    |       329.09        |   18.90   |       8.12       |\\n\\n:::info Results\\n\\nSimulating the three different MV values over a one-year period, we can conclude the following:\\n\\n- If MV < 1, the ASP can onboard more BTC each month than in the previous month.\\n- If MV = 1, the allowed value for onboarding BTC is always the same (half of the initial balance).\\n- If MV > 1, the value of allowed BTC to onboard converges to 0 over time, with the maximum onboard value equal to (initial balance) / (MV - 1).\\n\\n:::\\n\\n:::note\\n\\nThe money velocity (MV) for USD is quarterly. Assuming that M2 is constant and GDP is evenly distributed over the three months, the MV for one month should be \u2153 of the MV for the quarter, or 0.33.\\n\\n:::\\n\\n### Algorithm\\n\\n#### Allowed onboard value\\n\\nThe value of allowed onboard BTC for this round will be:\\n\\n:::info Allowed onboard formula\\n\\n(Available balance - User\u2019s funds in Ark \\\\* MV) / (1 + MV)\\n\\n:::\\n\\nWhere:\\n\\n- Available balance = Initial ASP balance + User\u2019s funds\\n- User\u2019s funds = All BTC onboarded by users until now\\n- MV = Money Velocity\\n\\n#### Money velocity\\n\\nTo calculate the value of Money Velocity:\\n\\n:::info Money Velocity formula\\n\\nAverage for the last N rounds of (amount transferred / user\u2019s funds)\\n\\n:::\\n\\n#### Rational\\n\\nThe ASP keeps records of onboarded and transferred amounts from previous rounds, and uses them to calculate the money velocity (MV) for the current round. It then uses the MV to calculate the maximum amount that can be onboarded in the current round.\\n\\nIf you\'ve read this far, thank you! But now it\'s time for the bad news.\\n\\n## The UTXO model\\n\\n<details>\\n<summary>How the UTXO Model Works</summary>\\n\\nIn the UTXO model, each unit of cryptocurrency is treated as a unique and indivisible entity. When a user spends cryptocurrency, they are not actually spending their entire balance. Instead, they are spending specific UTXOs that they own.\\n\\nEach UTXO has two important pieces of information:\\n\\n- The amount of cryptocurrency: This is the value of the UTXO.\\n- A locking script: This is a script that specifies how the UTXO can be spent. The locking script typically requires a digital signature from the owner of the UTXO.\\n\\nWhen a user wants to spend cryptocurrency, they create a new transaction. This transaction has two parts:\\n\\n- Inputs: These are the UTXOs that the user is spending.\\n- Outputs: These are the new UTXOs that will be created as a result of the transaction.\\n\\nThe locking scripts of the input UTXOs must be satisfied in order for the transaction to be valid. This ensures that only the rightful owner of the cryptocurrency can spend it.\\n\\n</details>\\n\\n### The change problem\\n\\nBut since Ark uses a UTXO model, this MV theory doesn\'t work, as the ASP will also need to fund the change on each transaction. For example, if Alice has a 1 BTC VTXO and wants to pay Bob 0.2 BTC, the ASP will need to fund two new VTXOs:\\n\\n- 0.2 BTC to Bob\\n- 0.8 BTC to Alice (change)\\n\\n#### Some simulations\\n\\nImagine that Alice boarded the Ark with 1 BTC. She has a 1 BTC VTXO and spends \u2153 of her money in the first month (MV = 0.33) using three payments of 0.11 BTC each.\\n\\nLet\'s also assume that these payments are inside Ark (to Bob), which means that the ASP will also need to fund Bob\'s VTXO.\\n\\n| Payment | Value | Alice VTXO | Bob VTXOs<br />(0.11 each) | Liquidity needed | Liquidity accum |\\n| :-----: | :---: | :--------: | :------------------------: | :--------------: | :-------------: |\\n|    0    |   0   |    1.00    |             0              |        0         |        0        |\\n|    1    | 0.11  |    0.89    |             1              |       1.00       |      1.00       |\\n|    2    | 0.11  |    0.78    |             2              |       0.89       |      1.89       |\\n|    3    | 0.11  |    0.67    |             3              |       0.78       |    **2.67**     |\\n\\nAt the end of the transaction, Alice has one VTXO of 0.67 BTC and Bob has three VTXOs of 0.11 BTC each.\\n\\n:::danger Huge funding needs (factor of **8**)\\n\\nThe ASP needed **2.67** of liquidity to support **0.33** traded inside Ark.\\n\\n:::\\n\\nThings get much worse if the user makes 10 payments instead of 3 (spending 0.033 BTC on each):\\n\\n| Payment | Value | Alice VTXO | Bob VTXOs<br />(0.033 each) | Liquidity needed | Liquidity accum |\\n| :-----: | :---: | :--------: | :-------------------------: | :--------------: | :-------------: |\\n|    0    |   0   |    1.00    |              0              |        0         |        0        |\\n|    1    | 0.033 |    0.97    |              1              |       1.00       |      1.00       |\\n|    2    | 0.033 |    0.93    |              2              |       0.97       |      1.97       |\\n|    3    | 0.033 |    0.90    |              3              |       0.93       |      2.90       |\\n|    4    | 0.033 |    0.87    |              4              |       0.90       |      3.80       |\\n|    5    | 0.033 |    0.84    |              5              |       0.87       |      4.67       |\\n|    6    | 0.033 |    0.80    |              6              |       0.84       |      5.51       |\\n|    7    | 0.033 |    0.77    |              7              |       0.80       |      6.31       |\\n|    8    | 0.033 |    0.74    |              8              |       0.77       |      7.08       |\\n|    9    | 0.033 |    0.70    |              9              |       0.74       |      7.81       |\\n|   10    | 0.033 |    0.67    |             10              |       0.70       |    **8.52**     |\\n\\n:::danger Huge funding needs (factor of **25**)\\n\\nThe ASP needed **8.52** of liquidity to support **0.33** traded inside Ark.\\n\\n:::\\n\\n### Possible mitigations\\n\\nOne can try to reduce these liquidity requirements by pushing several levers:\\n\\n- Reduce MV by reducing the timelock (e.g., 2 weeks instead of 1 month).\\n- Reduce transaction change by creating a set of UTXOs with a range of values on the first place, and then doing coin selection with the purpose of reducing change to the minimum possible.\\n\\n#### Reduce transaction change\\n\\n- Assuming MV = 0.33, and 10 payments of equal value during a month period\\n- Dividing Alice\u2019s initial UTXO into 10, 100, and 1000 VTXOs\\n\\nUsing a 1:10 ratio for VTXOs:\\n\\n| VTXO Value | Payment<br />number | Payment<br />value | VTXOs used | Alice balance | Alice VTXOs | Liquidity needed | Liquidity accum |\\n| :--------: | :-----------------: | :----------------: | :--------: | :-----------: | :---------: | :--------------: | :-------------: |\\n|    0.1     |          0          |       0.000        |     0      |     1.000     |     10      |       0.0        |      0.00       |\\n|    0.1     |          1          |       0.033        |     1      |     0.967     |     10      |       0.1        |      0.10       |\\n|    0.1     |          2          |       0.033        |     1      |     0.934     |     10      |       0.1        |      0.20       |\\n|    0.1     |          3          |       0.033        |     1      |     0.901     |     10      |       0.1        |      0.30       |\\n|    0.1     |          4          |       0.033        |     1      |     0.868     |     10      |       0.1        |      0.40       |\\n|    0.1     |          5          |       0.033        |     1      |     0.835     |     10      |       0.1        |      0.50       |\\n|    0.1     |          6          |       0.033        |     1      |     0.802     |     10      |       0.1        |      0.60       |\\n|    0.1     |          7          |       0.033        |     1      |     0.769     |     10      |       0.1        |      0.70       |\\n|    0.1     |          8          |       0.033        |     1      |     0.736     |     10      |       0.1        |      0.80       |\\n|    0.1     |          9          |       0.033        |     1      |     0.703     |     10      |       0.1        |      0.90       |\\n|    0.1     |         10          |       0.033        |     1      |     0.670     |     10      |       0.1        |      1.00       |\\n\\nUsing a 1:100 ratio for VTXOs:\\n\\n| VTXO Value | Payment<br />number | Payment<br />value | VTXOs used | Alice balance | Alice VTXOs | Liquidity needed | Liquidity accum |\\n| :--------: | :-----------------: | :----------------: | :--------: | :-----------: | :---------: | :--------------: | :-------------: |\\n|    0.01    |          0          |       0.000        |     0      |     1.000     |     100     |       0.0        |      0.00       |\\n|    0.01    |          1          |       0.033        |     4      |     0.967     |     97      |       0.04       |      0.04       |\\n|    0.01    |          2          |       0.033        |     4      |     0.934     |     94      |       0.04       |      0.08       |\\n|    0.01    |          3          |       0.033        |     4      |     0.901     |     91      |       0.04       |      0.12       |\\n|    0.01    |          4          |       0.033        |     4      |     0.868     |     88      |       0.04       |      0.16       |\\n|    0.01    |          5          |       0.033        |     4      |     0.835     |     85      |       0.04       |      0.20       |\\n|    0.01    |          6          |       0.033        |     4      |     0.802     |     82      |       0.04       |      0.24       |\\n|    0.01    |          7          |       0.033        |     4      |     0.769     |     79      |       0.04       |      0.28       |\\n|    0.01    |          8          |       0.033        |     4      |     0.736     |     76      |       0.04       |      0.32       |\\n|    0.01    |          9          |       0.033        |     4      |     0.703     |     73      |       0.04       |      0.36       |\\n|    0.01    |         10          |       0.033        |     4      |     0.670     |     70      |       0.04       |      0.40       |\\n\\nUsing a 1:1000 ratio for VTXOs:\\n\\n| VTXO Value | Payment<br />number | Payment<br />value | VTXOs used | Alice balance | Alice VTXOs | Liquidity needed | Liquidity accum |\\n| :--------: | :-----------------: | :----------------: | :--------: | :-----------: | :---------: | :--------------: | :-------------: |\\n|   0.001    |          0          |       0.000        |     0      |     1.000     |    1000     |       0.0        |      0.00       |\\n|   0.001    |          1          |       0.033        |     33     |     0.967     |     968     |      0.033       |      0.03       |\\n|   0.001    |          2          |       0.033        |     33     |     0.934     |     936     |      0.033       |      0.07       |\\n|   0.001    |          3          |       0.033        |     33     |     0.901     |     904     |      0.033       |      0.10       |\\n|   0.001    |          4          |       0.033        |     33     |     0.868     |     872     |      0.033       |      0.13       |\\n|   0.001    |          5          |       0.033        |     33     |     0.835     |     840     |      0.033       |      0.17       |\\n|   0.001    |          6          |       0.033        |     33     |     0.802     |     808     |      0.033       |      0.20       |\\n|   0.001    |          7          |       0.033        |     33     |     0.769     |     776     |      0.033       |      0.23       |\\n|   0.001    |          8          |       0.033        |     33     |     0.736     |     744     |      0.033       |      0.26       |\\n|   0.001    |          9          |       0.033        |     33     |     0.703     |     712     |      0.033       |      0.30       |\\n|   0.001    |         10          |       0.033        |     33     |     0.670     |     680     |      0.033       |      0.33       |\\n\\nComparison table:\\n\\n| VTXO ratio |   MV | # Payments | ASP liquidity needed |\\n| ---------: | ---: | ---------: | -------------------: |\\n|         10 | 0.33 |         10 |                 1.00 |\\n|        100 | 0.33 |         10 |                 0.40 |\\n|       1000 | 0.33 |         10 |                 0.33 |\\n\\n:::info conclusion\\n\\nDividing the initial UTXO into more VTXOs decreases the need for funding.\\n\\n:::\\n\\n## Conclusion\\n\\nThe liquidity requirements for an ASP will depend on three major factors:\\n\\n- **Money velocity**: This is not under the control of the ASP, and if it is higher than 1, the Ark capacity will converge to a fixed value.\\n- **The locktime period on VTXOs**: Reducing the locktime period will return the locked liquidity sooner. However, this also means that users will need to \\"recycle\\" their VTXOs sooner, which can be seen as a worse user experience.\\n- **The VTXO ratio**: In other words, this is the maximum allowed value for a given VTXO. At one extreme, the ASP could force all VTXOs to be of 1 sat, which would eliminate any \\"wasted\\" liquidity on change. However, this would also require millions of signatures from the user and ASP to construct a payment, which would cause a worse user experience.\\n\\n## References\\n\\n- Velocity of M2 Money Stock\\n  by St Louis Fed\\n  <https://fred.stlouisfed.org/series/M2V>\\n\\n- Lightning Report\\n  by River\\n  <https://river.com/learn/files/river-lightning-report-2023.pdf>\\n\\n- Cryptocurrencies and the Velocity of Money\\n  by Ingolf Gunnar Anton Pernice, Georg Gentzen, and Hermann Elendner\\n  <https://cryptoeconomicsystems.pubpub.org/pub/pernice-cryptocurrencies-velocity/release/9>"}]}')}}]);